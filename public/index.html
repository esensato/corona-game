<html>

        <meta charset="UTF-8">

<head>
    <title>Corona Game</title>

    <script>

        var info = '';

        const BOTAO_DIREITA = 39;
        const BOTAO_ESQUERDA = 37;
        const BOTAO_CIMA = 38;
        const BOTAO_BAIXO = 40;
        const PARADO = 32;
        const TAMANHO_BLOCO = 64;
        const LARGURA_TABULEIRO = 19;
        const ALTURA_TABULEIRO = 9;
        const TOTAL_IMAGEM = 18;
        const PESO_DIRECAO = 5;

        // carro representa o carro do jogador que recolhe os velhinhos
        var carro = {pos: {x: 0, y: 0}, imagem: "carrod", direcao: PARADO};

        var posCorona = [{pos: {x: 11 * TAMANHO_BLOCO, y:4 * TAMANHO_BLOCO}, novoSorteio: true, direcao: BOTAO_BAIXO, cima:0, baixo: 0, direita: 0, esquerda: 0}];

        var posVelhinho = [{pos: {x: 4 * TAMANHO_BLOCO, y:4 * TAMANHO_BLOCO}, novoSorteio: true, direcao: BOTAO_BAIXO, cima:false, baixo: false, direita: false, esquerda: false},
                         {pos: {x: 4 * TAMANHO_BLOCO, y:4 * TAMANHO_BLOCO}, novoSorteio: true, direcao: BOTAO_BAIXO, cima:false, baixo: false, direita: false, esquerda: false},
                         {pos: {x: 10 * TAMANHO_BLOCO, y:7 * TAMANHO_BLOCO}, novoSorteio: true, direcao: BOTAO_BAIXO, cima:false, baixo: false, direita: false, esquerda: false}];

        var tabuleiro =   [ "asfaltod", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoe", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "calcada", "calcada", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltod", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoe", "calcada", "asfaltov", "calcada", "asfaltod", "asfaltoh", "asfaltobe", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "asfaltov", "calcada", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "asfaltov", "calcada", "asfaltobd", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltobe", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "calcada", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltobd", "asfaltoe", "asfaltov", "calcada", "calcada", "calcada", "calcada", "calcada", "grama",   "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "asfaltov", "asfaltov", "calcada", "asfaltod", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoh", "asfaltoe", "calcada", "calcada", "calcada", "calcada", "asfaltov", "asfaltobd", "asfaltoh", "asfaltobe", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada", "calcada","calcada","asfaltobd","asfaltoh","asfaltoh","asfaltoh","asfaltoh","asfaltobe"];

        var imgBuffer = new Map();

        var imgFundo = null;

        var exibeSplash = true;
        var coronaSplashX = 0;
        var coronaSplashY = 0;

        function carregarImagem(nome, callback) {

            if (!imgBuffer.has(nome)) {

                var img = new Image(); 
                img.src =  'img/' + nome + '.png'; 
                img.onload = function() {
                    imgBuffer.set(nome, img);
                    console.log('Carregado: ' + img.src + ", " + imgBuffer.size);
                    if(imgBuffer.size == TOTAL_IMAGEM){
                        callback(imgBuffer.size);
                    }      
                }

            }

        }

        function carregarBufferImagens(callback) {

            for (var i = 0; i < tabuleiro.length; i++) {

                if (imgBuffer.get(tabuleiro[i]) == null) {
                    carregarImagem(tabuleiro[i], (total) => {console.log(total); callback();});
                }

            }

            carregarImagem('carroc', (total) => {console.log(total); callback();});
            carregarImagem('carrod', (total) => {console.log(total); callback();});
            carregarImagem('carroe', (total) => {console.log(total); callback();});
            carregarImagem('carrob', (total) => {console.log(total); callback();});
            carregarImagem('corona', (total) => {console.log(total); callback();});
            carregarImagem('explosao', (total) => {console.log(total); callback();});
            carregarImagem('titio', (total) => {console.log(total); callback();});
            carregarImagem('titio2', (total) => {console.log(total); callback();});
            carregarImagem('casa', (total) => {console.log(total); callback();});
            carregarImagem('splash', (total) => {console.log(total); callback();});

            console.log('Buffer de imagem carregado');

        }

        function criaImagemFundo() {

            var offCanvas = document.createElement('canvas');
            var ctxOffCanvas = offCanvas.getContext('2d');

            offCanvas.width = TAMANHO_BLOCO * LARGURA_TABULEIRO;
            offCanvas.height = TAMANHO_BLOCO * ALTURA_TABULEIRO;

            ctxOffCanvas.width = TAMANHO_BLOCO * LARGURA_TABULEIRO;
            ctxOffCanvas.height = TAMANHO_BLOCO * ALTURA_TABULEIRO;
            
            var linha = 0;
            var coluna = 0;

            for (var i = 0; i < tabuleiro.length; i++) {

                var img = imgBuffer.get(tabuleiro[i]);
                ctxOffCanvas.drawImage(img, coluna, linha);
                coluna += TAMANHO_BLOCO;
                if (LARGURA_TABULEIRO == (coluna / TAMANHO_BLOCO)) {
                    coluna = 0;
                    linha += TAMANHO_BLOCO;
                }

            }

            var meioX = (TAMANHO_BLOCO * LARGURA_TABULEIRO) / 2;
            var meioY = (TAMANHO_BLOCO * ALTURA_TABULEIRO) / 2;

            if (exibeSplash) {
                ctxOffCanvas.drawImage(imgBuffer.get('splash'), meioX - ((imgBuffer.get('splash').width / 2)), meioY - ((imgBuffer.get('splash').height / 2)));
                coronaSplashX = meioX;
                coronaSplashY = meioY;
            }

            imgBuffer.set('fundo', offCanvas);
            console.log('Imagem de fundo criada');

        }

        function direcionaCorona() {
            posCorona.forEach((corona) => {
                if (corona.novoSorteio) {
                    var direcoes = [];
                    var tabuleiroBaixo = getItemTabuleiro({x:corona.pos.x, y:corona.pos.y});
                    var tabuleiroFrente = getItemTabuleiro({x:corona.pos.x, y:corona.pos.y});
                    var tabuleiroTraseira = getItemTabuleiro({x:corona.pos.x, y:corona.pos.y});
                    var tabuleiroCima = getItemTabuleiro({x:corona.pos.x, y:corona.pos.y});

                    if (tabuleiroBaixo == undefined) {
                        tabuleiroBaixo = PARADO;
                    }
                    if (tabuleiroFrente == undefined) {
                        tabuleiroFrente = PARADO;
                    }
                    if (tabuleiroTraseira == undefined) {
                        tabuleiroTraseira = PARADO;
                    }
                    if (tabuleiroCima == undefined) {
                        tabuleiroCima = PARADO;
                    }
                    if (tabuleiroCima.item.startsWith('asfalto')){
                        direcoes.push(BOTAO_CIMA);
                    }
                    if (tabuleiroBaixo.item.startsWith('asfalto')){
                        direcoes.push(BOTAO_BAIXO);
                    }
                    if (tabuleiroFrente.item.startsWith('asfalto')){
                        direcoes.push(BOTAO_DIREITA);
                    }
                    if (tabuleiroTraseira.item.startsWith('asfalto')){
                        direcoes.push(BOTAO_ESQUERDA);
                    }

                    if (direcoes.length > 1) {
                        // apos uma quantidade de sorteios (PESO_DIRECAO)
                        // remove das possiveis direcoes a que foi mais sorteada e zera os contadores
                        var tot = (corona.cima + corona.baixo + corona.esquerda + corona.direita);
                        if (tot >= PESO_DIRECAO) {

                            var maiorQtdeSorteada = 0;
                            var direcaoMaisSorteada = PARADO;

                            if (corona.cima > maiorQtdeSorteada) {
                                maiorQtdeSorteada = corona.cima;
                                direcaoMaisSorteada = BOTAO_CIMA;
                            }
                            if (corona.baixo > maiorQtdeSorteada) {
                                maiorQtdeSorteada = corona.baixo;
                                direcaoMaisSorteada = BOTAO_BAIXO;
                            }
                            if (corona.direita > maiorQtdeSorteada) {
                                maiorQtdeSorteada = corona.direita;
                                direcaoMaisSorteada = BOTAO_DIREITA;
                            }
                            if (corona.esquerda > maiorQtdeSorteada) {
                                maiorQtdeSorteada = corona.esquerda;
                                direcaoMaisSorteada = BOTAO_ESQUERDA;
                            }

                            // cria um novo array sem a direcao mais sorteada
                            var novoDirecoes = [];
                            for (var i = 0; i < direcoes.length; i++) {
                                if (direcoes[i] != direcaoMaisSorteada){
                                    novoDirecoes.push(direcoes[i]);
                                }
                            }

                            direcoes = novoDirecoes;
                            console.log("REMOVE POSICAO POS = " + direcoes);

                            corona.cima = 0;
                            corona.baixo = 0;
                            corona.esquerda = 0;
                            corona.direita = 0;
                        }
                    }

                    corona.novoSorteio = false;
                    corona.direcao = direcoes[getRandomIntInclusive(0, direcoes.length - 1)];

                    // armazena a estatistica de quanto cada direcao foi sorteada
                    if (corona.direcao == BOTAO_CIMA){
                        corona.cima++;
                    } else if (corona.direcao == BOTAO_BAIXO){
                        corona.baixo++;
                    } else if (corona.direcao == BOTAO_ESQUERDA){
                        corona.esquerda++;
                    } else if (corona.direcao == BOTAO_DIREITA){
                        corona.direita++;
                    }

                }
            });
        }

        function moveCorona() {

            posCorona.forEach((corona) => {

                var tabuleiroBaixo = getItemTabuleiro({x: corona.pos.x + (TAMANHO_BLOCO / 2), y: corona.pos.y + TAMANHO_BLOCO});
                var tabuleiroFrente = getItemTabuleiro( {x: corona.pos.x + TAMANHO_BLOCO, y: corona.pos.y + (TAMANHO_BLOCO / 2)});
                var tabuleiroTraseira = getItemTabuleiro({x: corona.pos.x - 1, y: corona.pos.y + (TAMANHO_BLOCO / 2)});
                var tabuleiroCima = getItemTabuleiro({x: corona.pos.x + (TAMANHO_BLOCO / 2), y: corona.pos.y - 1});
                
                if (tabuleiroBaixo == undefined) {
                    tabuleiroBaixo = PARADO;
                }
                if (tabuleiroFrente == undefined) {
                    tabuleiroFrente = PARADO;
                }
                if (tabuleiroTraseira == undefined) {
                    tabuleiroTraseira = PARADO;
                }
                if (tabuleiroCima == undefined) {
                    tabuleiroCima = PARADO;
                }

                if (corona.direcao == BOTAO_CIMA) {
                        if (!tabuleiroCima.item.startsWith('asfalto')){
                            corona.direcao = PARADO;
                            corona.novoSorteio = true;
                        } else {
                            corona.pos.y -= 1;
                        }
                    } else if (corona.direcao == BOTAO_BAIXO) {
                        if (!tabuleiroBaixo.item.startsWith('asfalto')){
                            corona.direcao = PARADO;
                            corona.novoSorteio = true;
                        } else {
                            corona.pos.y += 1;
                        }                  
                    } else if (corona.direcao == BOTAO_ESQUERDA) {
                        if (!tabuleiroTraseira.item.startsWith('asfalto')){
                            corona.direcao = PARADO;
                            corona.novoSorteio = true;
                        } else {
                            corona.pos.x -= 1;
                        }
                    } else if (corona.direcao == BOTAO_DIREITA) {
                        if (!tabuleiroFrente.item.startsWith('asfalto')){
                            corona.direcao = PARADO;
                            corona.novoSorteio = true;
                        } else {
                            corona.pos.x += 1;
                        }

                    }
            });
        }

        // Movimento velhinos
        function direcionaVelhinho() {
            posVelhinho.forEach((velhinho) => {
                if (velhinho.novoSorteio) {
                    var direcoes = [];
                    //obtem itens no entorno do velhinho (cima, baixo, esquerda e direita)
                    var entorno = getItensEntorno(velhinho);

                    if (entorno.cima.startsWith('asfalto')){
                        direcoes.push(BOTAO_CIMA);
                    }
                    if (entorno.baixo.startsWith('asfalto')){
                        direcoes.push(BOTAO_BAIXO);
                    }
                    if (entorno.direita.startsWith('asfalto')){
                        direcoes.push(BOTAO_DIREITA);
                    }
                    if (entorno.esquerda.startsWith('asfalto')){
                        direcoes.push(BOTAO_ESQUERDA);
                    }

                    velhinho.novoSorteio = false;
                    velhinho.direcao = direcoes[getRandomIntInclusive(0, direcoes.length - 1)];

                }
            });
        }

        function moveVelhinho() {

            posVelhinho.forEach((velhinho) => {

                //obtem itens no entorno do velhinho (cima, baixo, esquerda e direita)
                var entorno = getItensEntorno(velhinho);
                
                if (velhinho.direcao == BOTAO_CIMA) {
                        if (!entorno.cima.startsWith('asfalto')){
                            velhinho.direcao = PARADO;
                            velhinho.novoSorteio = true;
                        } else {
                            velhinho.pos.y -= 1;
                        }
                    } else if (velhinho.direcao == BOTAO_BAIXO) {
                        if (!entorno.baixo.startsWith('asfalto')){
                            velhinho.direcao = PARADO;
                            velhinho.novoSorteio = true;
                        } else {
                            velhinho.pos.y += 1;
                        }                  
                    } else if (velhinho.direcao == BOTAO_ESQUERDA) {
                        if (!entorno.esquerda.startsWith('asfalto')){
                            velhinho.direcao = PARADO;
                            velhinho.novoSorteio = true;
                        } else {
                            velhinho.pos.x -= 1;
                        }
                    } else if (velhinho.direcao == BOTAO_DIREITA) {
                        if (!entorno.direita.startsWith('asfalto')){
                            velhinho.direcao = PARADO;
                            velhinho.novoSorteio = true;
                        } else {
                            velhinho.pos.x += 1;
                        }

                    }
            });
        }

        function animaCarro() {

            var offCanvas = document.getElementById('tabuleiro');
            var ctxOffCanvas = offCanvas.getContext("2d");

            if (pegouCorona()) {

                carro.imagem = "explosao";
                carro.direcao = PARADO;

            }

            var velhinhoPego = pegouVelhinho();
            if (velhinhoPego != null) {

                console.log("PEGOU = " + posVelhinho.indexOf(velhinhoPego));
                posVelhinho = removeElementoArray(posVelhinho, posVelhinho.indexOf(velhinhoPego));
            }

            if (carro.direcao != PARADO) {

                //obtem itens no entorno do carro (cima, baixo, esquerda e direita)
                var entorno = getItensEntorno(carro);

                if (carro.direcao == BOTAO_CIMA && carro.pos.y > 0) {
                    carro.imagem = "carroc";
                    if (!entorno.cima.startsWith('asfalto')){
                        carro.direcao = PARADO;
                    } else {
                        carro.pos.y -= 1;
                    }
                } else if (carro.direcao == BOTAO_BAIXO) {
                    carro.imagem = "carrob";
                    if (!entorno.baixo.startsWith('asfalto')){
                        carro.direcao = PARADO;
                    } else {
                        carro.pos.y += 1;
                    }                  
                } else if (carro.direcao == BOTAO_ESQUERDA && carro.pos.x > 0) {
                    carro.imagem = "carroe";
                    if (!entorno.esquerda.startsWith('asfalto')){
                        carro.direcao = PARADO;
                    } else {
                        carro.pos.x -= 1;
                    }
                } else if (carro.direcao == BOTAO_DIREITA) {
                    carro.imagem = "carrod";
                    if (!entorno.direita.startsWith('asfalto')){
                        carro.direcao = PARADO;
                    } else {
                        carro.pos.x += 1;
                    }

                }

            }

            ctxOffCanvas.drawImage(imgBuffer.get('fundo'), 0, 0);

            ctxOffCanvas.drawImage(imgBuffer.get(carro.imagem), carro.pos.x, carro.pos.y);

            posCorona.forEach((item) => {
                ctxOffCanvas.drawImage(imgBuffer.get('corona'), item.pos.x, item.pos.y);
            });

            posVelhinho.forEach((item) => {
                ctxOffCanvas.drawImage(imgBuffer.get('titio'), item.pos.x, item.pos.y);
            });

            direcionaCorona();
            moveCorona();
            direcionaVelhinho();
            moveVelhinho();
            printInfo();

        }

        function getItensEntorno(elemento) {

            //obtem pontos no tabuleiro do entorno
            var posEsquerda = {x: parseInt(elemento.pos.x / TAMANHO_BLOCO), y: parseInt((elemento.pos.y + (TAMANHO_BLOCO / 2))/ TAMANHO_BLOCO)};
            var posDireita = {x: parseInt((elemento.pos.x + TAMANHO_BLOCO) / TAMANHO_BLOCO), y: parseInt((elemento.pos.y + (TAMANHO_BLOCO / 2))/ TAMANHO_BLOCO)};
            var posCima = {x: parseInt((elemento.pos.x + (TAMANHO_BLOCO / 2)) / TAMANHO_BLOCO), y: parseInt(elemento.pos.y / TAMANHO_BLOCO)};
            var posBaixo = {x: parseInt((elemento.pos.x + (TAMANHO_BLOCO / 2)) / TAMANHO_BLOCO), y: parseInt((elemento.pos.y + TAMANHO_BLOCO) / TAMANHO_BLOCO)};

            info = "ESQ = " + JSON.stringify(posEsquerda);
            info += " DIR = " + JSON.stringify(posDireita);
            info += " CIMA = " + JSON.stringify(posCima);
            info += " BAIXO = " + JSON.stringify(posBaixo);

            //obtem os itens
            var itemCima = '';
            var itemBaixo = '';
            var itemEsquerda = '';
            var itemDireita = '';

            if (posCima.y >= 0) {
                itemCima = tabuleiro[LARGURA_TABULEIRO * posCima.y + posCima.x];
            }
            if (posBaixo.y < ALTURA_TABULEIRO) {
                itemBaixo = tabuleiro[LARGURA_TABULEIRO * posBaixo.y + posBaixo.x];
            }
            if (posEsquerda.x >= 0) {
                itemEsquerda = tabuleiro[LARGURA_TABULEIRO * posEsquerda.y + posEsquerda.x];
            }
            if (posDireita.x < LARGURA_TABULEIRO) {
                itemDireita = tabuleiro[LARGURA_TABULEIRO * posDireita.y + posDireita.x];
            }

            return {cima: itemCima, baixo: itemBaixo, esquerda: itemEsquerda, direita: itemDireita};

        }

        function getItemTabuleiro(pos) {

            var xTabuleiro = parseInt(pos.x / TAMANHO_BLOCO);
            var yTabuleiro = parseInt(pos.y / TAMANHO_BLOCO);
            var itemTabuleiro = '';
            if (xTabuleiro > 0 && yTabuleiro > 0 && xTabuleiro < LARGURA_TABULEIRO && yTabuleiro < ALTURA_TABULEIRO) {
                var posTabuleiro = LARGURA_TABULEIRO * yTabuleiro + xTabuleiro;
                itemTabuleiro = tabuleiro[posTabuleiro];     
            }       
            return {x: xTabuleiro, y: yTabuleiro, item: itemTabuleiro};
        }

        function getPosCarroTabuleiro() {
            return {x: parseInt((carro.pos.x + TAMANHO_BLOCO / 2) / TAMANHO_BLOCO), y: parseInt((carro.pos.y + TAMANHO_BLOCO / 2) / TAMANHO_BLOCO)};
        }

        function getPosTabuleiro(x, y) {
            return {x: parseInt((x + TAMANHO_BLOCO / 2)/ TAMANHO_BLOCO), y: parseInt((y + TAMANHO_BLOCO / 2) / TAMANHO_BLOCO)};
        }

        function printInfo() {
            /**
            var posCarroTabuleiro = getPosCarroTabuleiro();

            var tabuleiroBaixo = getItemTabuleiro(getCarroPontoBaixo());
            var tabuleiroFrente = getItemTabuleiro(getCarroPontoFrente());
            var tabuleiroTraseira = getItemTabuleiro(getCarroPontoTraseira());
            var tabuleiroCima = getItemTabuleiro(getCarroPontoCima());

            var info = 'X = ' + carroX + 'Y = ' + carroY + '<br>';
            info += 'posCarroTabuleiro = ' + JSON.stringify(posCarroTabuleiro) + '<br>';
            info += 'tabuleiroBaixo = ' + JSON.stringify(tabuleiroBaixo) + '<br>';
            info += 'tabuleiroFrente = ' + JSON.stringify(tabuleiroFrente) + '<br>';
            info += 'tabuleiroTraseira = ' + JSON.stringify(tabuleiroTraseira) + '<br>';
            info += 'tabuleiroCima = ' + JSON.stringify(tabuleiroCima) + '<br>';
            info += 'tabuleiroCima = ' + JSON.stringify(tabuleiroCima) + '<br>';

            posCorona.forEach((item) => {
                if (posCarroTabuleiro.x == item.x && posCarroTabuleiro.y == item.y){
                    info += 'VIRUSSSSS ' + '<br>';
                }
            });

            info += 'temCorona = ' + temCorona() + '<br>';
            **/

            //info += JSON.stringify(getItensEntorno(carro)) + '<br>';
            document.getElementById('info').innerHTML = info;
            //info = '';
        }

        function pegouCorona() {

            var posCarroTabuleiro = getPosCarroTabuleiro();
            var resultado = false;
            posCorona.forEach((item) => {

                var posCoronaTabuleiro = getPosTabuleiro(item.pos.x, item.pos.y);
                if (posCarroTabuleiro.x == posCoronaTabuleiro.x && posCarroTabuleiro.y == posCoronaTabuleiro.y){
                    resultado = true;
                    return;
                }
            });
            
            return resultado;

        }

        function pegouVelhinho() {

            var posCarroTabuleiro = getPosCarroTabuleiro();
            var resultado = null;
            posVelhinho.forEach((item) => {

                var posVelhinhoTabuleiro = getPosTabuleiro(item.pos.x, item.pos.y);
                if (posCarroTabuleiro.x == posVelhinhoTabuleiro.x && posCarroTabuleiro.y == posVelhinhoTabuleiro.y){
                    resultado = item;
                    return;
                }
            });

            return resultado;

        }

        function animacao() {

            window.setInterval(function(){
                animaCarro();
            }, 10);

        }

        function eventoTeclado(event) {

            //obtem itens no entorno do carro (cima, baixo, esquerda e direita)
            var entorno = getItensEntorno(carro);

            if (event.keyCode == BOTAO_BAIXO &&
                entorno.baixo.startsWith('asfalto')) {
                carro.direcao = BOTAO_BAIXO;
            } else if (event.keyCode == BOTAO_CIMA && carro.pos.y > 0 &&
                       entorno.cima.startsWith('asfalto')) {
                carro.direcao = BOTAO_CIMA;
            } else if (event.keyCode == BOTAO_ESQUERDA && carro.pos.x > 0  &&
                entorno.esquerda.startsWith('asfalto')) {
                carro.direcao = BOTAO_ESQUERDA;
            } else if (event.keyCode == BOTAO_DIREITA &&
                entorno.direita.startsWith('asfalto')) {
                carro.direcao = BOTAO_DIREITA;
            }

        }

        function splash() {

           var offCanvas = document.getElementById('tabuleiro');
           var ctxOffCanvas = offCanvas.getContext("2d");
            ctxOffCanvas.drawImage(imgBuffer.get('fundo'), 0, 0);

        }

        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function inicio(event) {
            var x = event.clientX;
            var y = event.clientY;

            //alert(JSON.stringify(getItensEntorno({pos:{x: event.clientX, y: event.clientY}})));
            if (x >= 360 && x <= 490 && y >= 370 && y <= 500) {
                exibeSplash = false;
                criaImagemFundo();
                animacao();
            }

        }

        function removeElementoArray(array, indice) {
            var novoArray = [];
            for (var i = 0; i < array.length; i++) {
                if (i != indice) {
                    novoArray.push(array[i]);
                }
            }

            return novoArray;
        }

    </script>

</head>

<body onkeydown="eventoTeclado(event);" onclick="inicio(event)">

    <div>

        <canvas id="tabuleiro" style="border: solid 1px">
        </canvas>

    </div>

<div id="info"></div>

<script>
        document.getElementById('tabuleiro').width = LARGURA_TABULEIRO * TAMANHO_BLOCO;
        document.getElementById('tabuleiro').height = ALTURA_TABULEIRO * TAMANHO_BLOCO;

        carregarBufferImagens(()=>{
            console.log('OK');
            criaImagemFundo();
            splash();
            });

</script>

</body>
</html>